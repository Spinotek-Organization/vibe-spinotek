<!doctype html>
<html lang="id" x-data="ayoLari()" x-init="init()">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#022c22" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Ayo Lari - Teman Lari Digital Kamu</title>
    <meta
      name="description"
      content="Mulai kebiasaan lari dengan cara yang sederhana dan tidak menakutkan. Ayo Lari adalah teman lari digital untuk pemula."
    />

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#ecfdf5",
                100: "#d1fae5",
                200: "#a7f3d0",
                300: "#6ee7b7",
                400: "#34d399",
                500: "#10b981",
                600: "#059669",
                700: "#047857",
                800: "#065f46",
                900: "#064e3b",
                950: "#022c22",
              },
            },
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Mobile-first base styles */
      * {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }
      
      /* Safe area support for notched devices */
      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      }
      
      /* Custom Animations */
      @keyframes pulse-ring {
        0% { transform: scale(0.95); opacity: 1; }
        50% { transform: scale(1.08); opacity: 0.7; }
        100% { transform: scale(0.95); opacity: 1; }
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        25% { transform: translateY(-8px) rotate(2deg); }
        75% { transform: translateY(-8px) rotate(-2deg); }
      }

      @keyframes gradient-shift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }
      
      @keyframes glow-pulse {
        0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3), 0 0 40px rgba(16, 185, 129, 0.1); }
        50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.5), 0 0 60px rgba(16, 185, 129, 0.2); }
      }
      
      @keyframes slide-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .animate-pulse-ring {
        animation: pulse-ring 2s ease-in-out infinite;
      }

      .animate-float {
        animation: float 4s ease-in-out infinite;
      }

      .gradient-animate {
        background-size: 200% 200%;
        animation: gradient-shift 4s ease infinite;
      }
      
      .animate-glow {
        animation: glow-pulse 3s ease-in-out infinite;
      }
      
      .animate-slide-up {
        animation: slide-up 0.5s ease-out forwards;
      }

      /* Timer Circle */
      .timer-circle {
        stroke-dasharray: 565.48;
        stroke-dashoffset: 0;
        transform: rotate(-90deg);
        transform-origin: center;
        transition: stroke-dashoffset 0.3s linear;
        filter: drop-shadow(0 0 8px currentColor);
      }

      /* Modern Glass morphism */
      .glass {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.05) 100%);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }
      
      .glass-card {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.02) 100%);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
      }

      .glass-dark {
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      /* Neumorphism button */
      .neu-btn {
        background: linear-gradient(145deg, #059669, #047857);
        box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.4), -4px -4px 15px rgba(16, 185, 129, 0.15);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .neu-btn:active {
        transform: scale(0.96);
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.4), -2px -2px 8px rgba(16, 185, 129, 0.1);
      }
      
      /* Smooth scroll */
      html {
        scroll-behavior: smooth;
        overflow-x: hidden;
      }

      /* Phase colors with glow */
      .phase-walk { --phase-color: #10b981; --phase-glow: rgba(16, 185, 129, 0.4); }
      .phase-run { --phase-color: #f59e0b; --phase-glow: rgba(245, 158, 11, 0.4); }
      .phase-rest { --phase-color: #0ea5e9; --phase-glow: rgba(14, 165, 233, 0.4); }
      
      /* Touch-friendly buttons */
      .touch-btn {
        min-height: 48px;
        min-width: 48px;
      }
      
      /* Haptic feedback simulation */
      .haptic:active {
        transform: scale(0.97);
      }
      
      /* Modern scrollbar */
      ::-webkit-scrollbar { width: 4px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: rgba(16, 185, 129, 0.3); border-radius: 2px; }
      
      /* Card hover effect for touch */
      .card-lift {
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
      }
      .card-lift:active {
        transform: scale(0.98) translateY(2px);
      }
      @media (hover: hover) {
        .card-lift:hover {
          transform: translateY(-4px);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
      }
    </style>
  </head>
  <body
    class="font-sans antialiased bg-gradient-to-br from-primary-950 via-primary-900 to-primary-950 min-h-screen text-white"
  >
    <!-- ======================= -->
    <!-- DEVICE SIZE WARNING -->
    <!-- ======================= -->
    <div 
      x-data="{ 
        screenWidth: window.innerWidth,
        init() {
          window.addEventListener('resize', () => this.screenWidth = window.innerWidth);
        }
      }"
      x-show="screenWidth >= 640"
      class="fixed inset-0 z-[100] bg-gradient-to-br from-primary-950 via-primary-900 to-primary-950 flex items-center justify-center p-6"
    >
      <div class="text-center max-w-md">
        <!-- Icon based on screen size -->
        <div class="text-8xl mb-6">
          <span x-show="screenWidth >= 640 && screenWidth < 1024">ğŸ“±</span>
          <span x-show="screenWidth >= 1024">ğŸ’»</span>
        </div>
        
        <!-- Tablet message (640px - 1023px) -->
        <template x-if="screenWidth >= 640 && screenWidth < 1024">
          <div>
            <h1 class="text-3xl font-bold text-white mb-4">Waduh, Tabletnya Kegedean! ğŸ“</h1>
            <p class="text-primary-300 text-lg mb-6">
              Aplikasi ini didesain khusus untuk HP biar gampang dibawa lari.
            </p>
            <div class="glass-card rounded-2xl p-4 text-left">
              <p class="text-primary-400 text-sm">
                ğŸ’¡ <strong class="text-white">Tips:</strong> Buka di HP kamu atau kecilkan ukuran browser ke mode mobile.
              </p>
            </div>
          </div>
        </template>
        
        <!-- Desktop/Laptop message (1024px+) -->
        <template x-if="screenWidth >= 1024">
          <div>
            <h1 class="text-3xl font-bold text-white mb-4">Waduh, Laptopnya Kegedean!</h1>
            <p class="text-primary-300 text-lg mb-4">
              Masa lari sambil bawa laptop? Nanti dikira mau meeting di jalan! ğŸ˜‚
            </p>
            <p class="text-primary-400 mb-6">
              Aplikasi ini untuk dibawa lari pakai HP, bukan dipajang di meja.
            </p>
            <div class="glass-card rounded-2xl p-4 text-left">
              <p class="text-primary-400 text-sm">
                ğŸ’¡ <strong class="text-white">Tips:</strong> Scan QR code ini pakai HP atau buka langsung di browser HP kamu.
              </p>
            </div>
          </div>
        </template>
        
        <!-- Fun animation -->
        <div class="mt-8 text-6xl animate-bounce">
          <span x-show="screenWidth >= 640 && screenWidth < 1024">ğŸ‘†</span>
          <span x-show="screenWidth >= 1024">ğŸƒ</span>
        </div>
      </div>
    </div>
    <!-- ======================= -->
    <!-- HOME / LANDING SECTION -->
    <!-- ======================= -->
    <section
      x-show="currentView === 'home'"
      x-transition:enter="transition ease-out duration-500"
      x-transition:enter-start="opacity-0 transform translate-y-4"
      x-transition:enter-end="opacity-100 transform translate-y-0"
      class="min-h-screen flex flex-col"
    >
      <!-- Hero Content -->
      <div class="flex-1 flex flex-col items-center justify-center px-5 py-8 pb-safe">
        
        <!-- Ambient glow background -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
          <div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-96 h-96 bg-primary-500/20 rounded-full blur-3xl"></div>
          <div class="absolute bottom-1/4 left-1/4 w-64 h-64 bg-primary-600/10 rounded-full blur-2xl"></div>
        </div>
        
        <!-- AI Robot Icon -->
        <div class="animate-float mb-6 relative z-10">
          <div class="w-28 h-28 bg-gradient-to-br from-cyan-400 via-primary-500 to-blue-600 rounded-full flex items-center justify-center shadow-2xl animate-glow border-4 border-cyan-400/30">
            <span class="text-5xl">ğŸ¤–</span>
          </div>
          <!-- Status indicator -->
          <div class="absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full border-4 border-primary-900 animate-pulse"></div>
        </div>

        <!-- AI Greeting -->
        <p class="text-cyan-400 text-sm font-mono uppercase tracking-widest mb-2 relative z-10">
          [ SYSTEM ONLINE ]
        </p>

        <!-- Title -->
        <h1 class="text-4xl sm:text-5xl md:text-7xl font-extrabold text-center mb-3 bg-gradient-to-r from-cyan-300 via-primary-400 to-cyan-300 bg-clip-text text-transparent gradient-animate relative z-10">
          LARI.AI
        </h1>

        <!-- AI Subtitle -->
        <p class="text-base sm:text-lg md:text-xl text-primary-300/90 text-center max-w-sm sm:max-w-md mb-6 leading-relaxed relative z-10 px-2">
          <span class="text-cyan-400 font-semibold">Selamat datang, Boss.</span><br>
          Saya asisten AI pribadi untuk membantu program lari Anda.
        </p>

        <!-- Stats Cards - Modern grid layout -->
        <div class="grid grid-cols-3 gap-3 w-full max-w-sm mb-8 relative z-10">
          <div class="glass-card rounded-2xl p-4 text-center border border-cyan-500/20">
            <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-cyan-400 to-cyan-600 rounded-xl flex items-center justify-center">
              <span class="text-xl">ğŸ“Š</span>
            </div>
            <p class="text-white font-bold text-lg">3</p>
            <p class="text-cyan-400 text-xs font-mono">PROGRAM</p>
          </div>
          <div class="glass-card rounded-2xl p-4 text-center border border-cyan-500/20">
            <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-primary-400 to-primary-600 rounded-xl flex items-center justify-center">
              <span class="text-xl">âš¡</span>
            </div>
            <p class="text-white font-bold text-lg">15-30</p>
            <p class="text-cyan-400 text-xs font-mono">MENIT</p>
          </div>
          <div class="glass-card rounded-2xl p-4 text-center border border-cyan-500/20">
            <div class="w-12 h-12 mx-auto mb-2 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center">
              <span class="text-xl">ğŸ¯</span>
            </div>
            <p class="text-white font-bold text-lg">AI</p>
            <p class="text-cyan-400 text-xs font-mono">GUIDED</p>
          </div>
        </div>

        <!-- CTA Button - Large touch target -->
        <button
          @click="currentView = 'select'"
          class="neu-btn relative w-full max-w-xs py-5 rounded-2xl text-lg font-bold text-white haptic relative z-10 border border-cyan-500/30"
        >
          <span class="flex items-center justify-center gap-3">
            <span>Mulai Analisis</span>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
            </svg>
          </span>
        </button>

        <!-- Progress Summary (if exists) -->
        <template x-if="progress.sessionsCompleted > 0">
          <div class="mt-8 glass-card rounded-3xl p-5 max-w-xs w-full text-center relative z-10">
            <div class="grid grid-cols-3 gap-3">
              <div class="p-2">
                <p class="text-2xl font-bold text-white" x-text="progress.sessionsCompleted"></p>
                <p class="text-xs text-primary-400">Sesi</p>
              </div>
              <div class="p-2">
                <p class="text-2xl font-bold text-white" x-text="progress.totalMinutes"></p>
                <p class="text-xs text-primary-400">Menit</p>
              </div>
              <div class="p-2">
                <p class="text-2xl font-bold text-amber-400 flex items-center justify-center gap-1">
                  <span x-text="progress.currentStreak"></span>
                  <span class="text-base">ğŸ”¥</span>
                </p>
                <p class="text-xs text-primary-400">Streak</p>
              </div>
            </div>
          </div>
        </template>
      </div>

      <!-- Footer - AI branding -->
      <footer class="text-center py-4 text-cyan-600 text-xs font-mono">
        LARI.AI v1.0 â€¢ Powered by AI untuk Indonesia sehat
      </footer>
    </section>

    <!-- ======================= -->
    <!-- LEVEL SELECTION SECTION -->
    <!-- ======================= -->
    <section
      x-show="currentView === 'select'"
      x-transition:enter="transition ease-out duration-500"
      x-transition:enter-start="opacity-0 transform translate-y-4"
      x-transition:enter-end="opacity-100 transform translate-y-0"
      class="min-h-screen flex flex-col px-4 py-6 pb-safe"
    >
      <!-- Header - larger touch targets -->
      <div class="flex items-center justify-between mb-4">
        <button
          @click="currentView = 'home'"
          class="w-12 h-12 rounded-2xl glass flex items-center justify-center haptic touch-btn border border-cyan-500/20"
        >
          <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <div class="text-center">
          <p class="text-cyan-400 text-xs font-mono uppercase">[ Analisis Kondisi ]</p>
          <h2 class="text-lg font-bold text-white">Pilih Program</h2>
        </div>
        <div class="w-12"></div>
      </div>

      <!-- Level Cards - optimized for mobile -->
      <div class="flex-1 flex flex-col justify-center max-w-lg mx-auto w-full space-y-3">
        <!-- Level 1: Pemula -->
        <button
          @click="selectLevel('pemula')"
          class="glass-card card-lift rounded-3xl p-5 text-left haptic w-full"
        >
          <div class="flex items-start gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-green-400 to-emerald-600 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg shadow-green-500/20">
              <span class="text-2xl">ğŸŒ±</span>
            </div>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <h3 class="text-lg font-bold text-white">Pemula Banget</h3>
                <span class="inline-flex items-center gap-1 px-2.5 py-1 bg-green-500/20 rounded-lg text-xs text-green-400 font-semibold">
                  15 min
                </span>
              </div>
              <p class="text-primary-400 text-sm mb-2">Baru pertama kali atau sudah lama tidak lari</p>
              <div class="flex items-center gap-2 text-xs text-primary-500">
                <span>ğŸš¶ Jalan 2 min</span>
                <span>â†’</span>
                <span>ğŸƒ Lari 1 min</span>
                <span>â†’</span>
                <span>ğŸ”„ 5x</span>
              </div>
            </div>
          </div>
        </button>

        <!-- Level 2: Menengah -->
        <button
          @click="selectLevel('menengah')"
          class="glass-card card-lift rounded-3xl p-5 text-left haptic w-full"
        >
          <div class="flex items-start gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-amber-400 to-orange-600 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg shadow-amber-500/20">
              <span class="text-2xl">ğŸŒ¿</span>
            </div>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <h3 class="text-lg font-bold text-white">Mulai Terbiasa</h3>
                <span class="inline-flex items-center gap-1 px-2.5 py-1 bg-amber-500/20 rounded-lg text-xs text-amber-400 font-semibold">
                  20 min
                </span>
              </div>
              <p class="text-primary-400 text-sm mb-2">Sudah pernah lari beberapa kali</p>
              <div class="flex items-center gap-2 text-xs text-primary-500">
                <span>ğŸš¶ Jalan 2 min</span>
                <span>â†’</span>
                <span>ğŸƒ Lari 3 min</span>
                <span>â†’</span>
                <span>ğŸ”„ 4x</span>
              </div>
            </div>
          </div>
        </button>

        <!-- Level 3: Lanjutan -->
        <button
          @click="selectLevel('lanjutan')"
          class="glass-card card-lift rounded-3xl p-5 text-left haptic w-full"
        >
          <div class="flex items-start gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-sky-400 to-blue-600 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg shadow-sky-500/20">
              <span class="text-2xl">ğŸŒ³</span>
            </div>
            <div class="flex-1">
              <div class="flex items-center justify-between mb-1">
                <h3 class="text-lg font-bold text-white">Sudah Nyaman</h3>
                <span class="inline-flex items-center gap-1 px-2.5 py-1 bg-sky-500/20 rounded-lg text-xs text-sky-400 font-semibold">
                  30 min
                </span>
              </div>
              <p class="text-primary-400 text-sm mb-2">Rutin lari dan ingin meningkatkan</p>
              <div class="flex items-center gap-2 text-xs text-primary-500">
                <span>ğŸš¶ Warm up 3 min</span>
                <span>â†’</span>
                <span>ğŸƒ Lari 25 min</span>
                <span>â†’</span>
                <span>ğŸ˜®â€ğŸ’¨ Cool down</span>
              </div>
            </div>
          </div>
        </button>
      </div>

      <!-- Tip - more prominent on mobile -->
      <div class="mt-6 text-center pb-4">
        <div class="inline-block glass rounded-2xl px-5 py-3">
          <p class="text-primary-300 text-sm">
            ğŸ’¡ Tidak yakin? Coba <strong class="text-white">Pemula Banget</strong>!
          </p>
        </div>
      </div>
    </section>

    <!-- ======================= -->
    <!-- RUNNING SESSION SECTION -->
    <!-- ======================= -->
    <section
      x-show="currentView === 'session'"
      x-transition:enter="transition ease-out duration-500"
      x-transition:enter-start="opacity-0 transform scale-95"
      x-transition:enter-end="opacity-100 transform scale-100"
      class="min-h-screen flex flex-col px-4 py-6 pb-safe"
    >
      <!-- Header - larger touch targets -->
      <div class="flex items-center justify-between mb-4">
        <button
          @click="confirmExit()"
          class="w-12 h-12 rounded-2xl glass flex items-center justify-center haptic touch-btn"
        >
          <svg class="w-6 h-6 text-primary-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <div class="text-center flex-1 mx-4">
          <h2 class="text-lg font-bold text-white truncate" x-text="programs[selectedLevel]?.name"></h2>
          <div class="flex items-center justify-center gap-2 mt-1">
            <div class="flex gap-1">
              <template x-for="(phase, idx) in programs[selectedLevel]?.phases || []" :key="idx">
                <div 
                  class="w-2 h-2 rounded-full transition-all duration-300"
                  :class="idx < timer.phaseIndex ? 'bg-primary-400' : idx === timer.phaseIndex ? 'bg-white scale-125' : 'bg-primary-700'"
                ></div>
              </template>
            </div>
          </div>
        </div>
        <div class="w-12"></div>
      </div>

      <!-- Timer Display -->
      <div class="flex-1 flex flex-col items-center justify-center">
        <!-- Phase Description -->
        <p class="text-primary-300 text-sm mb-4 text-center" x-text="getCurrentPhaseLabel()"></p>

        <!-- Circular Timer - Modern Design -->
        <div class="relative w-64 h-64 sm:w-72 sm:h-72 mb-6">
          <!-- Outer glass ring -->
          <div class="absolute inset-0 rounded-full glass-card"></div>
          
          <!-- Glow effect behind -->
          <div 
            class="absolute inset-8 rounded-full blur-xl opacity-40 transition-colors duration-500"
            :class="{
              'bg-green-500': timer.currentPhase === 'walk',
              'bg-amber-500': timer.currentPhase === 'run',
              'bg-sky-500': timer.currentPhase === 'rest'
            }"
          ></div>
          
          <!-- SVG Timer Ring -->
          <svg class="absolute inset-0 w-full h-full" viewBox="0 0 200 200">
            <!-- Outer decorative ring -->
            <circle cx="100" cy="100" r="95" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="2"/>
            
            <!-- Background track -->
            <circle cx="100" cy="100" r="80" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="10"/>
            
            <!-- Progress ring with gradient -->
            <defs>
              <linearGradient id="timerGradientWalk" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#34d399"/>
                <stop offset="100%" stop-color="#10b981"/>
              </linearGradient>
              <linearGradient id="timerGradientRun" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#fbbf24"/>
                <stop offset="100%" stop-color="#f59e0b"/>
              </linearGradient>
              <linearGradient id="timerGradientRest" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#38bdf8"/>
                <stop offset="100%" stop-color="#0ea5e9"/>
              </linearGradient>
            </defs>
            
            <circle
              cx="100" cy="100" r="80" fill="none"
              class="timer-circle"
              :stroke="timer.currentPhase === 'walk' ? 'url(#timerGradientWalk)' : timer.currentPhase === 'run' ? 'url(#timerGradientRun)' : 'url(#timerGradientRest)'"
              stroke-width="10"
              stroke-linecap="round"
              :style="{ strokeDashoffset: getTimerOffset() * 80/90 }"
              style="stroke-dasharray: 502.65;"
            />
            
            <!-- Inner decorative ring -->
            <circle cx="100" cy="100" r="68" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
          </svg>

          <!-- Timer Content -->
          <div class="absolute inset-0 flex flex-col items-center justify-center z-20">
            <!-- Phase Icon -->
            <div class="text-3xl mb-1">
              <span x-show="timer.currentPhase === 'walk'">ğŸš¶</span>
              <span x-show="timer.currentPhase === 'run'">ğŸƒ</span>
              <span x-show="timer.currentPhase === 'rest'">ğŸ˜®â€ğŸ’¨</span>
            </div>
            
            <!-- Time -->
            <span 
              class="text-5xl sm:text-6xl font-bold tabular-nums"
              :class="{
                'text-green-400': timer.currentPhase === 'walk',
                'text-amber-400': timer.currentPhase === 'run',
                'text-sky-400': timer.currentPhase === 'rest'
              }"
              x-text="formatTime(timer.phaseRemaining)"
            ></span>
            
            <!-- Phase label -->
            <span class="text-xs text-primary-400 mt-1 uppercase tracking-wider">
              <span x-show="timer.currentPhase === 'walk'">Jalan</span>
              <span x-show="timer.currentPhase === 'run'">Lari</span>
              <span x-show="timer.currentPhase === 'rest'">Istirahat</span>
            </span>
          </div>

          <!-- Pulse Animation when running -->
          <div
            x-show="timer.isRunning && !timer.isPaused"
            class="absolute inset-0 rounded-full animate-pulse-ring pointer-events-none"
            :class="{
              'bg-green-500/5': timer.currentPhase === 'walk',
              'bg-amber-500/5': timer.currentPhase === 'run',
              'bg-sky-500/5': timer.currentPhase === 'rest'
            }"
          ></div>
        </div>

        <!-- Motivational Message -->
        <div class="glass-card rounded-2xl px-5 py-3 max-w-xs w-full text-center mb-6">
          <p class="text-primary-200 text-sm" x-text="motivation"></p>
        </div>

        <!-- Overall Progress -->
        <div class="w-full max-w-sm mb-6">
          <div class="flex justify-between text-xs text-primary-500 mb-2">
            <span>Progress Total</span>
            <span x-text="formatTime(timer.totalElapsed) + ' / ' + formatTime(timer.totalSeconds)"></span>
          </div>
          <div class="h-3 bg-primary-800/50 rounded-full overflow-hidden">
            <div
              class="h-full bg-gradient-to-r from-primary-500 to-primary-300 transition-all duration-500 rounded-full"
              :style="{ width: getOverallProgress() + '%' }"
            ></div>
          </div>
        </div>

        <!-- Control Buttons - larger for mobile -->
        <div class="flex items-center gap-6 pb-6">
          <!-- Skip Phase (left) -->
          <button
            @click="skipPhase()"
            class="w-16 h-16 rounded-2xl glass flex items-center justify-center haptic touch-btn"
          >
            <svg class="w-7 h-7 text-primary-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
            </svg>
          </button>
          
          <!-- Pause/Resume (center - large) -->
          <button
            @click="togglePause()"
            class="w-24 h-24 rounded-full neu-btn flex items-center justify-center haptic animate-glow"
          >
            <template x-if="!timer.isPaused">
              <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
              </svg>
            </template>
            <template x-if="timer.isPaused">
              <svg class="w-10 h-10 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </template>
          </button>
          
          <!-- Placeholder for balance -->
          <div class="w-16 h-16"></div>
        </div>
      </div>
    </section>

    <!-- ======================= -->
    <!-- SESSION COMPLETE SECTION -->
    <!-- ======================= -->
    <section
      x-show="currentView === 'complete'"
      x-transition:enter="transition ease-out duration-700"
      x-transition:enter-start="opacity-0 transform scale-90"
      x-transition:enter-end="opacity-100 transform scale-100"
      class="min-h-screen flex flex-col items-center justify-center px-4 py-8 pb-safe"
    >
      <!-- Celebration -->
      <div class="text-center w-full max-w-sm">
        <!-- AI Success Animation -->
        <div class="relative">
          <div class="text-8xl mb-4 animate-bounce">ğŸ¤–</div>
          <div class="absolute inset-0 pointer-events-none">
            <div class="absolute top-0 left-1/4 text-2xl animate-float" style="animation-delay: 0.2s;">âœ…</div>
            <div class="absolute top-0 right-1/4 text-2xl animate-float" style="animation-delay: 0.5s;">âš¡</div>
          </div>
        </div>

        <p class="text-cyan-400 text-sm font-mono uppercase tracking-widest mb-2">[ MISSION COMPLETE ]</p>
        <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-2">Excellent, Boss!</h2>
        <p class="text-lg text-primary-300 mb-6">
          Sesi lari berhasil diselesaikan ğŸ¯
        </p>

        <!-- Session Stats - Combined card -->
        <div class="glass-card rounded-3xl p-5 w-full mb-5">
          <!-- Level name - full width -->
          <div class="text-center mb-4 p-3 bg-primary-800/30 rounded-2xl">
            <p class="text-xs text-primary-400 mb-1">Level</p>
            <p class="text-xl font-bold text-white" x-text="sessionStats.level"></p>
          </div>
          
          <!-- Duration -->
          <div class="text-center p-4 bg-gradient-to-br from-primary-600/30 to-primary-700/30 rounded-2xl mb-4">
            <p class="text-5xl font-bold text-white" x-text="sessionStats.duration"></p>
            <p class="text-sm text-primary-300 mt-1">Menit Diselesaikan âœ…</p>
          </div>
          
          <!-- Divider -->
          <div class="border-t border-primary-700/50 my-4"></div>
          
          <!-- Total Progress -->
          <div class="grid grid-cols-3 gap-3">
            <div class="text-center">
              <p class="text-2xl font-bold text-primary-300" x-text="progress.sessionsCompleted"></p>
              <p class="text-xs text-primary-500">Total Sesi</p>
            </div>
            <div class="text-center">
              <p class="text-2xl font-bold text-primary-300" x-text="progress.totalMinutes"></p>
              <p class="text-xs text-primary-500">Total Min</p>
            </div>
            <div class="text-center">
              <p class="text-2xl font-bold text-amber-400 flex items-center justify-center gap-1">
                <span x-text="progress.currentStreak"></span>
                <span class="text-lg">ğŸ”¥</span>
              </p>
              <p class="text-xs text-primary-500">Streak</p>
            </div>
          </div>
        </div>

        <!-- Motivation -->
        <p class="text-primary-300 text-sm mb-6 px-4" x-text="getCompletionMessage()"></p>

        <!-- Action Buttons - full width on mobile -->
        <div class="flex flex-col gap-3 w-full">
          <button
            @click="currentView = 'home'"
            class="w-full py-4 neu-btn rounded-2xl text-white font-bold haptic"
          >
            Kembali ke Beranda
          </button>
          <button
            @click="shareProgress()"
            class="w-full py-4 glass rounded-2xl text-primary-200 font-medium flex items-center justify-center gap-2 haptic"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
            Bagikan Progress
          </button>
        </div>
      </div>
    </section>

    <!-- ======================= -->
    <!-- SHARE MODAL -->
    <!-- ======================= -->
    <div
      x-show="showShareModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/60 backdrop-blur-sm"
      @click.self="showShareModal = false"
    >
      <div
        class="bg-primary-900 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-primary-700"
      >
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-white">Bagikan Progress</h3>
          <button
            @click="showShareModal = false"
            class="text-primary-400 hover:text-white transition-colors"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <!-- Share Preview -->
        <div
          class="bg-gradient-to-br from-primary-800 to-primary-900 rounded-xl p-4 mb-4 text-center border border-primary-700"
        >
          <p class="text-primary-200 text-sm mb-2">ğŸƒ Ayo Lari!</p>
          <p class="text-white font-bold text-lg mb-1">
            Saya baru saja menyelesaikan sesi lari!
          </p>
          <p class="text-primary-300 text-sm">
            <span x-text="progress.sessionsCompleted"></span> sesi â€¢
            <span x-text="progress.totalMinutes"></span> menit â€¢
            <span x-text="progress.currentStreak"></span> hari streak ğŸ”¥
          </p>
          <p class="text-primary-500 text-xs mt-3">
            #AyoLari #HealthyLifestyle
          </p>
        </div>

        <!-- Share Buttons -->
        <div class="grid grid-cols-3 gap-3">
          <button
            @click="shareToTwitter()"
            class="flex flex-col items-center gap-2 p-3 rounded-xl bg-[#1DA1F2]/20 hover:bg-[#1DA1F2]/30 text-[#1DA1F2] transition-colors"
          >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
              />
            </svg>
            <span class="text-xs">Twitter</span>
          </button>
          <button
            @click="shareToWhatsApp()"
            class="flex flex-col items-center gap-2 p-3 rounded-xl bg-[#25D366]/20 hover:bg-[#25D366]/30 text-[#25D366] transition-colors"
          >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
              />
            </svg>
            <span class="text-xs">WhatsApp</span>
          </button>
          <button
            @click="copyShareText()"
            class="flex flex-col items-center gap-2 p-3 rounded-xl bg-primary-700/50 hover:bg-primary-700 text-primary-300 transition-colors"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
              />
            </svg>
            <span
              class="text-xs"
              x-text="copied ? 'Tersalin!' : 'Salin'"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <!-- ======================= -->
    <!-- EXIT CONFIRMATION MODAL -->
    <!-- ======================= -->
    <div
      x-show="showExitModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/70 backdrop-blur-sm"
      @click.self="showExitModal = false"
    >
      <div 
        class="glass-card rounded-3xl p-6 max-w-sm w-full text-center"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform scale-90"
        x-transition:enter-end="opacity-100 transform scale-100"
      >
        <!-- Warning Icon -->
        <div class="w-16 h-16 mx-auto mb-4 bg-red-500/20 rounded-full flex items-center justify-center">
          <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
        </div>
        
        <h3 class="text-xl font-bold text-white mb-2">Keluar dari Sesi?</h3>
        <p class="text-primary-300 text-sm mb-6">
          Progress sesi ini tidak akan disimpan. Kamu yakin ingin berhenti?
        </p>
        
        <!-- Buttons -->
        <div class="flex flex-col gap-3">
          <button
            @click="showExitModal = false"
            class="w-full py-4 neu-btn rounded-2xl text-white font-bold haptic"
          >
            Lanjut Berlari
          </button>
          <button
            @click="confirmExitSession()"
            class="w-full py-3 glass rounded-2xl text-red-400 font-medium haptic"
          >
            Ya, Keluar
          </button>
        </div>
      </div>
    </div>

    <!-- ======================= -->
    <!-- ALPINE.JS DATA & LOGIC -->
    <!-- ======================= -->
    <script>
      function ayoLari() {
        return {
          // Views: 'home', 'select', 'session', 'complete'
          currentView: "home",
          selectedLevel: null,
          showShareModal: false,
          showExitModal: false,
          copied: false,

          // Audio context for beeps
          audioContext: null,

          // Timer state
          timer: {
            totalSeconds: 0,
            totalElapsed: 0,
            phaseRemaining: 0,
            phaseDuration: 0,
            isRunning: false,
            isPaused: false,
            currentPhase: "walk",
            phaseIndex: 0,
            intervalId: null,
          },

          // Current motivation message
          motivation: "",

          // Session stats for completion screen
          sessionStats: {
            duration: 0,
            level: "",
          },

          // Progress data (saved to localStorage)
          progress: {
            sessionsCompleted: 0,
            totalMinutes: 0,
            currentStreak: 0,
            lastSessionDate: null,
          },

          // Running programs
          programs: {
            pemula: {
              name: "Pemula Banget",
              totalMinutes: 15,
              phases: [
                {
                  type: "walk",
                  duration: 180,
                  label: "Pemanasan - jalan santai",
                },
                { type: "run", duration: 60, label: "Lari ringan" },
                { type: "walk", duration: 90, label: "Jalan pemulihan" },
                { type: "run", duration: 60, label: "Lari ringan" },
                { type: "walk", duration: 90, label: "Jalan pemulihan" },
                { type: "run", duration: 60, label: "Lari ringan" },
                { type: "walk", duration: 90, label: "Jalan pemulihan" },
                { type: "run", duration: 60, label: "Lari ringan" },
                {
                  type: "walk",
                  duration: 180,
                  label: "Pendinginan - jalan santai",
                },
              ],
            },
            menengah: {
              name: "Mulai Terbiasa",
              totalMinutes: 20,
              phases: [
                {
                  type: "walk",
                  duration: 180,
                  label: "Pemanasan - jalan cepat",
                },
                { type: "run", duration: 120, label: "Lari sedang" },
                { type: "walk", duration: 60, label: "Jalan pemulihan" },
                { type: "run", duration: 150, label: "Lari sedang" },
                { type: "walk", duration: 60, label: "Jalan pemulihan" },
                { type: "run", duration: 180, label: "Lari sedang" },
                { type: "walk", duration: 60, label: "Jalan pemulihan" },
                { type: "run", duration: 150, label: "Lari sedang" },
                { type: "walk", duration: 180, label: "Pendinginan" },
              ],
            },
            lanjutan: {
              name: "Sudah Nyaman",
              totalMinutes: 30,
              phases: [
                { type: "walk", duration: 180, label: "Pemanasan" },
                { type: "run", duration: 300, label: "Lari kontinyu" },
                { type: "rest", duration: 60, label: "Istirahat sebentar" },
                { type: "run", duration: 360, label: "Lari kontinyu" },
                { type: "rest", duration: 60, label: "Istirahat sebentar" },
                { type: "run", duration: 420, label: "Lari kontinyu" },
                { type: "rest", duration: 60, label: "Istirahat sebentar" },
                { type: "run", duration: 180, label: "Sprint akhir" },
                { type: "walk", duration: 180, label: "Pendinginan" },
              ],
            },
          },

          // AI Coach messages - JARVIS style
          motivations: {
            start: [
              "Sistem aktif. Memulai protokol lari, Boss. ğŸ¤–",
              "Analisis kondisi: Anda siap untuk sesi ini.",
              "Menginisialisasi program latihan... Semangat!",
              "Catatan: Setiap langkah meningkatkan performa Anda.",
            ],
            walk: [
              "Fase jalan aktif. Jaga ritme, Boss. ğŸ‘£",
              "Optimasi pernapasan: Tarik... keluarkan...",
              "Status: Cardio dalam zona aman. Lanjutkan.",
              "Analisis: Langkah Anda semakin stabil.",
            ],
            run: [
              "Fase lari diaktifkan. Anda mampu, Boss! ğŸ”¥",
              "Detak jantung optimal. Pertahankan kecepatan.",
              "Sistem merekam performa Anda. Impressive!",
              "Catatan: Lari ringan, efisiensi maksimal.",
            ],
            rest: [
              "Fase recovery. Istirahat sejenak, Boss.",
              "Regenerasi energi dalam proses...",
              "Status: Sistem pemulihan aktif. âš¡",
            ],
            halfway: [
              "Laporan: 50% sesi tercapai! Excellent, Boss. ğŸ¯",
              "Progress: Setengah perjalanan selesai.",
              "Analisis: Performa Anda di atas rata-rata!",
            ],
            almostDone: [
              "Hampir selesai, Boss! Final push! ğŸ’ª",
              "Status: 90% sesi tercapai. Keep going!",
              "Sistem mendeteksi Anda hampir finish!",
            ],
          },

          completionMessages: [
            "Sesi selesai. Anda luar biasa hari ini, Boss! ğŸ‰",
            "Analisis lengkap: Performa excellent. Tubuh berterima kasih.",
            "Catatan: +1 sesi untuk gaya hidup sehat Anda. ğŸŒ¿",
            "Sistem menyimpan progress. Sampai jumpa besok, Boss! ğŸ‘‹",
            "Endorfin terdeteksi. Nikmati efeknya! ğŸ˜Š",
          ],

          // Initialize
          init() {
            this.loadProgress();
            this.initAudio();
          },

          // Initialize Web Audio API for beeps
          initAudio() {
            try {
              this.audioContext = new (
                window.AudioContext || window.webkitAudioContext
              )();
            } catch (e) {
              console.log("Web Audio API not supported");
            }
          },

          // Play beep sound
          playBeep(frequency = 800, duration = 150) {
            if (!this.audioContext) return;

            try {
              // Resume audio context if suspended (required for some browsers)
              if (this.audioContext.state === "suspended") {
                this.audioContext.resume();
              }

              const oscillator = this.audioContext.createOscillator();
              const gainNode = this.audioContext.createGain();

              oscillator.connect(gainNode);
              gainNode.connect(this.audioContext.destination);

              oscillator.frequency.value = frequency;
              oscillator.type = "sine";

              gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(
                0.01,
                this.audioContext.currentTime + duration / 1000,
              );

              oscillator.start(this.audioContext.currentTime);
              oscillator.stop(this.audioContext.currentTime + duration / 1000);
            } catch (e) {
              console.log("Audio playback failed");
            }
          },

          // Play transition beeps (3 short beeps)
          playTransitionBeeps() {
            this.playBeep(600, 100);
            setTimeout(() => this.playBeep(700, 100), 150);
            setTimeout(() => this.playBeep(800, 200), 300);
          },

          // Load progress from localStorage
          loadProgress() {
            const saved = localStorage.getItem("ayolari_progress");
            if (saved) {
              this.progress = JSON.parse(saved);
              this.checkStreak();
            }
          },

          // Save progress to localStorage
          saveProgress() {
            localStorage.setItem(
              "ayolari_progress",
              JSON.stringify(this.progress),
            );
          },

          // Check and update streak
          checkStreak() {
            if (!this.progress.lastSessionDate) return;

            const lastDate = new Date(this.progress.lastSessionDate);
            const today = new Date();
            const diffDays = Math.floor(
              (today - lastDate) / (1000 * 60 * 60 * 24),
            );

            if (diffDays > 1) {
              // Streak broken
              this.progress.currentStreak = 0;
              this.saveProgress();
            }
          },

          // Select level and start session
          selectLevel(level) {
            this.selectedLevel = level;
            this.startSession();
          },

          // Start running session
          startSession() {
            const program = this.programs[this.selectedLevel];

            // Calculate total seconds
            this.timer.totalSeconds = program.phases.reduce(
              (sum, phase) => sum + phase.duration,
              0,
            );
            this.timer.totalElapsed = 0;
            this.timer.phaseIndex = 0;
            this.timer.isRunning = true;
            this.timer.isPaused = false;

            // Set first phase
            this.setPhase(0);

            // Set initial motivation
            this.motivation = this.getRandomMessage(this.motivations.start);

            // Switch view
            this.currentView = "session";

            // Start timer
            this.runTimer();
          },

          // Set current phase
          setPhase(index) {
            const program = this.programs[this.selectedLevel];
            if (index >= program.phases.length) {
              this.completeSession();
              return;
            }

            const phase = program.phases[index];
            this.timer.phaseIndex = index;
            this.timer.currentPhase = phase.type;
            this.timer.phaseDuration = phase.duration;
            this.timer.phaseRemaining = phase.duration;

            // Play transition beep (except for first phase)
            if (index > 0) {
              this.playTransitionBeeps();
            }

            // Set motivation based on phase
            this.motivation = this.getRandomMessage(
              this.motivations[phase.type] || this.motivations.walk,
            );
          },

          // Run timer
          runTimer() {
            if (this.timer.intervalId) {
              clearInterval(this.timer.intervalId);
            }

            this.timer.intervalId = setInterval(() => {
              if (!this.timer.isRunning || this.timer.isPaused) return;

              this.timer.phaseRemaining--;
              this.timer.totalElapsed++;

              // Check for motivational message updates
              const progressPercent =
                (this.timer.totalElapsed / this.timer.totalSeconds) * 100;
              if (progressPercent >= 45 && progressPercent < 50) {
                this.motivation = this.getRandomMessage(
                  this.motivations.halfway,
                );
              } else if (progressPercent >= 85 && progressPercent < 90) {
                this.motivation = this.getRandomMessage(
                  this.motivations.almostDone,
                );
              }

              // Check if phase is complete
              if (this.timer.phaseRemaining <= 0) {
                this.setPhase(this.timer.phaseIndex + 1);
              }
            }, 1000);
          },

          // Toggle pause/resume
          togglePause() {
            this.timer.isPaused = !this.timer.isPaused;
            if (!this.timer.isPaused) {
              this.playBeep(500, 100);
            }
          },

          // Skip to next phase
          skipPhase() {
            this.timer.totalElapsed += this.timer.phaseRemaining;
            this.setPhase(this.timer.phaseIndex + 1);
          },

          // Complete session
          completeSession() {
            clearInterval(this.timer.intervalId);
            this.timer.isRunning = false;

            // Update session stats
            const program = this.programs[this.selectedLevel];
            this.sessionStats.duration = program.totalMinutes;
            this.sessionStats.level = program.name;

            // Update progress
            const today = new Date().toDateString();
            if (this.progress.lastSessionDate !== today) {
              // New day - increment streak
              const lastDate = new Date(this.progress.lastSessionDate);
              const todayDate = new Date();
              const diffDays = Math.floor(
                (todayDate - lastDate) / (1000 * 60 * 60 * 24),
              );

              if (diffDays === 1) {
                this.progress.currentStreak++;
              } else if (diffDays > 1 || !this.progress.lastSessionDate) {
                this.progress.currentStreak = 1;
              }
            }

            this.progress.sessionsCompleted++;
            this.progress.totalMinutes += program.totalMinutes;
            this.progress.lastSessionDate = today;
            this.saveProgress();

            // Play completion sound (celebratory)
            this.playBeep(523, 150); // C
            setTimeout(() => this.playBeep(659, 150), 150); // E
            setTimeout(() => this.playBeep(784, 300), 300); // G

            // Switch to complete view
            this.currentView = "complete";
          },

          // Confirm exit - show modal
          confirmExit() {
            this.timer.isPaused = true; // Pause timer while modal is open
            this.showExitModal = true;
          },
          
          // Actually exit the session
          confirmExitSession() {
            clearInterval(this.timer.intervalId);
            this.timer.isRunning = false;
            this.showExitModal = false;
            this.currentView = "home";
          },

          // Get current phase label
          getCurrentPhaseLabel() {
            const program = this.programs[this.selectedLevel];
            if (!program) return "";
            return program.phases[this.timer.phaseIndex]?.label || "";
          },

          // Get random message from array
          getRandomMessage(messages) {
            return messages[Math.floor(Math.random() * messages.length)];
          },

          // Get completion message
          getCompletionMessage() {
            return this.completionMessages[
              Math.floor(Math.random() * this.completionMessages.length)
            ];
          },

          // Format seconds to MM:SS
          formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
          },

          // Get timer circle offset
          getTimerOffset() {
            if (this.timer.phaseDuration === 0) return 0;
            const progress =
              this.timer.phaseRemaining / this.timer.phaseDuration;
            const circumference = 565.48; // 2 * PI * 90
            return circumference * (1 - progress);
          },

          // Get overall progress percentage
          getOverallProgress() {
            if (this.timer.totalSeconds === 0) return 0;
            return (this.timer.totalElapsed / this.timer.totalSeconds) * 100;
          },

          // Share functions
          shareProgress() {
            this.showShareModal = true;
          },

          getShareText() {
            return `ğŸƒ Ayo Lari!\n\nSaya baru saja menyelesaikan sesi lari!\nğŸ“Š ${this.progress.sessionsCompleted} sesi â€¢ ${this.progress.totalMinutes} menit â€¢ ${this.progress.currentStreak} hari streak ğŸ”¥\n\n#AyoLari #HealthyLifestyle`;
          },

          shareToTwitter() {
            const text = encodeURIComponent(this.getShareText());
            window.open(
              `https://twitter.com/intent/tweet?text=${text}`,
              "_blank",
            );
          },

          shareToWhatsApp() {
            const text = encodeURIComponent(this.getShareText());
            window.open(`https://wa.me/?text=${text}`, "_blank");
          },

          copyShareText() {
            navigator.clipboard.writeText(this.getShareText()).then(() => {
              this.copied = true;
              setTimeout(() => (this.copied = false), 2000);
            });
          },
        };
      }
    </script>
  </body>
</html>
